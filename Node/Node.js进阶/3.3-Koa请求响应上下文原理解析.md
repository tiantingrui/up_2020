# Koa请求响应上下文原理解析

### Main Target

+ 理解委托模式
+ 洋葱模型
+ 构造请求响应语法糖
+ 构造上下文语法糖



## 01. 理解委托模式



#### 设计模式-委托

+ JavaScript 事件委托 - 事件冒泡给父元素处理
+ JavaScript 行为委托 - 原型继承实现原型链
+ delegates 外层暴露的对象将请求委托给内部的其他对象进行处理
+ Koa中使用委托的目的：拉齐使用体验，避免重复实例化 req/res



#### 手写delegate依赖包

+ TJ 已经离开了Node社区（转写Go 去了），项目已不维护
+ delegate 实现中使用 了部分过期的方式
+ 基于现有的ES标准可以写得更加优雅
+ 控制属性的读写权限



## 02. compose



#### compose

+ 面向切面编程（AOP）
+ 动态代理（模式）植入目标代码
+ 洋葱模型 - 中间件模型





## 03. 构造请求响应体语法糖

#### 请求响应体

+ Object.create() 方法创建一个新对象，使用现有的对象来提供新创建的对象的  `__proto__`
+ 使用getter/setter 封装Node 原生request/response
+ 实现jQuery式的属性使用
+ 使用accept处理HTTP请求协议



#### 上下文语法糖

+ **单一context原则：**每一个请求都有唯一一个context 对象
+ 所有的关于请求和相应的东西都放在context 里面，共享所有资源使用context 具有高内聚的性质，内部元素互相能访问到



#### 最后小结

+ 委托模式
  + Koa中比较重要的设计模式
+ 中间件模型
  + 深入研究了 composed 原理
+ 构造响应体
  + 构造请求响应结构体
+ 构造上下文
  + 构造上下文语法糖，便于调用

