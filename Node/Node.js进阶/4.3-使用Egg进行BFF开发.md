# 使用Egg进行BFF开发

### Main Target

+ 重新认识BFF
+ Egg中如何组织BFF层
+ GraphQL as BFF
+ BFF 的困境与未来





## 01. 重新认识BFF

### API网关

+ 企业所有后端服务的入口--外观模式
+ 单节点网关
+ BFF网关



### BFF层-聚合层/适配层

+ 适用于API网关之后的数据聚合、裁剪与透传
+ 简化客户端逻辑，减少网络开销
+ 多协议发布
+ 避免无意义的数据透传
+ 敏感信息过滤



## 02. Egg中如何组织BFF层

### 约定和规范优于配置

+ 控制器Controller 表现层内容
+ 服务Service 业务逻辑
+ 配置Config 多环境全局配置
+ 模板View 静态文件或前端文件
+ 单测test



### 插件机制

+ Koa 本身专注于HTTP 的封装，内核简单
+ 中间件在企业应用中存在局限性
+ 对于企业应用来讲，需要更多的上层封装才能支撑稳定的业务需求
+ egg插件是围绕某个功能组织的拓展集合，解决Koa的局限性
+ 插件机制有丰富的拓展点（Context/Application）



## 03. GraphQL as BFF

### GraphQL概览

+ API查询语言
+ 前后端通信的中间媒介
+ 高度灵活性



### GraphQL基本用法

1. 描述你的数据
2. 请求你所要的数据
3. 得到可预测的结果



### graphQL实践中的一些误解

+ GraphQL不一定要操作数据库
+ GraphQL跟Restful API 不是对立的
+ GraphQL 不一定是一个后端服务
+ GraphQL不一定需要Schema
+ GraphQL不一定返回JSON数据格式



## 04. BFF的困境与未来

### BFF的困境

+ 研发成本上升
+ 流程繁琐
+ 运维经验不足



### Serverless带来的未来





### Serverless 不是银弹

| 优势             | 劣势                      |
| ---------------- | ------------------------- |
| 开发运行环境统一 | 过度依赖第三方云商能力    |
| 资源按需计费     | 不适合长时间任务（10min） |
| 丰富的SDK和服务  | 冷启动时间                |
| 弹性伸缩服务     | 调试与测试会产生费用      |





### 最后小结

+ 重新认识BFF
  + 了解BFF在当前企业中的应用场景
+ Egg与BFF
  + 感受BFF架构到来的遍历，熟悉编码范式
+ GraphQL
  + GraphQL模式的优势和劣势
+ 困境和未来
  + BFF模式在企业中落地遇到的问题及实际应用中的解决方案



